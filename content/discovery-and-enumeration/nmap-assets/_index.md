+++
title = "Asset discovery with Nmap"
menuTitle = "Nmap"
weight = 1
+++

![](./trinity.png)

## 1. Basic Ping Sweep
Usually all you need to uncover lots of juicy assets (potential attack targets)

```bash
nmap -sn -iL ranges.txt -oA pingsweep
```
 * `-sn: Ping Scan - disable port scan`
   * Tell nmap not to do a port scan
 * `-iL <inputfilename>: Input from list of hosts/networks`
   * File containing IP ranges from your scope
 * `-oA <basename>: Output in the three major formats at once`
   * Output three files .nmap, .gnmap and .xml

## 2. RMI Asset Discovery
Sometimes a system administrator will intentionally configure hosts to ignore ICMP requests making them difficult to discover.  
Try this if the Basic Ping Sweep doesn't yield the results you're expecting.
The logic behind it is that systems were stood up for a reason and it's likely the system administrator is too busy to physicaly login 
every time maintenance is required. 
For this reason it is highly likely they configured some sort of remote management interface. These ports are simply the most common ports used for remote administration.
You can tweak this scan to have more or fewer ports keeping in mind the more ports you're checking the longer you'll have to wait on large scopes.

```bash
nmap -Pn -n -p 22,445,80,443,3389 -iL ranges.txt -oA rmisweep
```

## 3. Subnet hunting
What if the client has a Class A `/8` network and with 16.7Mil possible IPs and has no idea where everything is?  No problem!
The logic here is that hypothetically speaking, each `/24` subnet is going to have a gateway on the `.1` node.  
So isntead of checking for 16 million possible IPs we only need to check for 65 thousand possible gateways.

```bash
nmap -sn 10.1-255.1-255.1 --min-rate 10000 --min-hostgroup 1024 -oA subnetsweep
```
* `--min-hostgroup/max-hostgroup <size>: Parallel host scan group sizes`
  * Secret sauce that tells nmap to check 1,024 hosts at a time instead of 64 =P
* `--min-rate <number>: Send packets no slower than <number> per second`
  * Ignore the posted speed and scan super fast!

[//]:![](./docbrown1.jpg)

### 3.1. Perform regular discovery on subnets
Here is a quick command to turn the `subnetsweep.gnmap` file into a new `ranges.txt` file that you can use for basic or RMI asset discovery.

```bash
grep "Up" subnetsweep | cut -d " " -f2 | awk -F "." '{print $1"."$2"."$3".0/24"}' > ranges.txt
```


## 4. Grepable Nmap
The `.gnmap` file generated by the above sweeps presents an easily "grepable" output you can use to build a list of targets.  For simplicity lets call it `targets.txt`

```bash
cat *.gnmap | grep "Up" | cut -d " " -f2 > targets.txt
```
